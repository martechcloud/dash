<!DOCTYPE html>
<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Martech Cloud</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="css/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="libs/perfect-scrollbar/perfect-scrollbar.css" />

    <link rel="stylesheet" href="libs/apex-charts/apex-charts.css" />

    <!-- Page CSS -->
    <style>
      body {
          display: flex;
          flex-direction: column;
          font-family: 'Roboto', Arial, sans-serif;
          margin: 0;
          padding: 0;
          background-color: #f9fafb;
          color: #333;
      }
      /* Header Styling */
      .header {
          width: 100%;
          background: linear-gradient(90deg, #ff7e5f, #feb47b);
          box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
          position: fixed;
          top: 0;
          z-index: 1000;
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 10px 20px;
      }
      .header input {
          width: 300px;
          padding: 10px 15px;
          border: 1px solid #ddd;
          border-radius: 20px;
          outline: none;
          transition: all 0.3s ease;
      }
      .header input:focus {
          box-shadow: 0 0 10px rgba(255, 126, 95, 0.5);
          border-color: #ff7e5f;
      }
      .main-content {
          display: flex;
          margin-top: 20px;
          width: 100%;
      }
      .menu-items1 {
          width: 100%;
          padding: 10px;
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
      }
      .menu-item1 {
          width: 23%;
          text-align: center;
          background-color: #ffffff;
          border-radius: 8px;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
          padding: 15px;
          transition: transform 0.3s, box-shadow 0.3s;
          cursor: pointer;
      }

      .menu-item1:hover {
          transform: translateY(-5px);
          box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      }

      .menu-item1 p {
          color: #555;
          margin-top: 10px;
          font-size: 14px;
      }
      #menu-items {
        overflow-y: auto;  /* Enables vertical scrolling */
      }

      #menu-items::-webkit-scrollbar {
          display: none; /* Hides scrollbar in WebKit browsers (e.g., Chrome, Safari) */
      }

      .billing ul {
          list-style: none;
          padding: 10px;
          margin: 10px;
          border-collapse: collapse;
          width: 100%;
      }

      .billing ul li {
          display: grid;
          grid-template-columns: 3fr 1fr 1fr 1fr;
          padding: 10px;
          font-size: 14px;
          color: #444;
          border-bottom: 1px solid #ddd;
      }

      .billing ul li:last-child {
          border-bottom: none;
      }

      .billing ul li .item-name {
          padding-left: 10px;
      }

      .billing .quantity-control {
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .billing .quantity-control button {
          margin: 0 5px;
          padding: 5px 10px;
          background-color: grey;
          color: #fff;
          border: none;
          border-radius: 3px;
          cursor: pointer;
          font-size: 14px;
      }

      .billing .quantity-control button:hover {
          background-color: black;
      }

      .billing .total {
          font-weight: bold;
          margin-top: 20px;
          font-size: 18px;
          color: #000;
          text-align: right;
          padding-top: 10px;
          border-top: 1px solid #ddd;
          padding-right: 20px;
      }

      /* Add gridlines between headers and items */
      .billing ul li.header {
          font-weight: bold;
          background-color: #f1f1f1;
          border-top: 2px solid #ddd;
      }

      .billing ul li.header div {
          padding: 10px;
          text-align: center;
      }
      /* General styling for the billing section */
      .billing {
          width: 70%;
          background-color: #fff;
          border: 1px solid #ddd;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* Styling for the table */
      .billing table {
          padding: 10px;
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 15px;
      }

      .billing th, .billing td {
          text-align: left;
          padding: 8px;
          border-bottom: 1px solid #ddd;
      }

      .billing th {
          background-color: black;
          color: white;
          font-weight: bold;
          font-size: 15px;
      }

      .billing td {
          color: #333;
          font-size: 15px;
      }

      .billing thead tr {
          border-bottom: 2px solid #ddd;
      }

      /* Styling for the unordered list */
      .billing ul#bill-items {
          list-style-type: none;
          padding: 0;
          margin: 0 0 15px;
      }

      .billing ul#bill-items li {
          padding: 8px 0;
          border-bottom: 1px solid #f1f1f1;
          color: #666;
          font-size: 14px;
      }

      .billing ul#bill-items li:last-child {
          border-bottom: none;
      }

      /* Subtotal section */
      .billing .total {
          text-align: right;
          font-size: 15px;
          font-weight: bold;
          color: #333;
          padding-top: 10px;
          border-top: 2px solid #ddd;
      }

      .billing .total span {
          color: #e91e63;
      }

      .billing th {
          text-align: center;
      }

      .billing th:first-child {
          text-align: left;
      }

      .billing td {
          text-align: center;
      }

      .billing td:first-child {
          text-align: left;
      }


    </style>
    <style>
      body {
        overflow: hidden; /* Removes the page scrollbar */
      }
    
      .card.mb-4 {
          overflow-y: auto; /* Enables vertical scrolling for the card */
          scrollbar-width: none; /* Hides scrollbar in Firefox */
      }

      .card.mb-4::-webkit-scrollbar {
          display: none; /* Hides scrollbar in Chrome, Safari, etc. */
      }
    </style>
     

    <!-- Helpers -->
    <script src="js/helpers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="js/config.js"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="martechclouddashboard.html" class="app-brand-link"> <!--! Not sure what it is and what its implecations-->
              <span class="app-brand-logo demo">
              </span>
              <span class="app-brand-text demo menu-text fw-bolder ms-0" style="text-transform: capitalize;">Martech Cloud</span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
              <i class="bx bx-chevron-left bx-sm align-middle"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            <!-- Dashboard -->
            <li class="menu-item">
              <a href="martechclouddashboard.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div data-i18n="Analytics">Dashboard</div>
              </a>
            </li>

            <!-- Layouts -->
            <li class="menu-item active open">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-layout"></i>
                <div data-i18n="Layouts">Audience</div>
              </a>

              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="martechcloudcontactmaster.html" class="menu-link">
                    <div data-i18n="Without menu">Contact Master</div>
                  </a>
                </li>
                <li class="menu-item active">
                  <a href="martechcloudaddcontacts.html" class="menu-link">
                    <div data-i18n="Without navbar">Add Contacts</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="martechcloudblacklistcontacts.html" class="menu-link">
                    <div data-i18n="Container">Blacklist Contacts</div>
                  </a>
                </li>
              </ul>
            </li>

            <li class="menu-header small text-uppercase">
              <span class="menu-header-text">Engage</span>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-cube-alt"></i>
                <div data-i18n="Misc">Content</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="martechcloudemailcontent.html" class="menu-link">
                    <div data-i18n="Error">Email</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="pages-misc-under-maintenance.html" class="menu-link">
                    <div data-i18n="Error">SMS</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="martechcloudwhatsappcontent.html" class="menu-link">
                    <div data-i18n="Under Maintenance">WhatsApp</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="pages-misc-under-maintenance.html" class="menu-link">
                    <div data-i18n="Error">Instagram</div>
                  </a>
                </li>
              </ul>
            </li>
            <!-- Misc -->
            <li class="menu-header small text-uppercase"><span class="menu-header-text">Action</span></li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-user"></i>
                <div data-i18n="Misc">Account</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="martechcloudmyprofile.html" class="menu-link">
                    <div data-i18n="Error">My Profile</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="martechcloudsettings.html" class="menu-link">
                    <div data-i18n="Under Maintenance">Settings</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="#" class="menu-link">
                    <div data-i18n="Error">Billing</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item">
              <a
                href="#"
                class="menu-link"
                onclick="logout()"
              >
                <i class="menu-icon tf-icons bx bx-power-off me-2"></i>
                <div data-i18n="Documentation">Log Out</div>
              </a>
            </li>
          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar"
          >
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                <i class="bx bx-menu bx-sm"></i>
              </a>
            </div>

            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              
              <ul class="navbar-nav flex-row align-items-center ms-auto">
                <!-- Place this tag where you want the button to render. -->
                <li class="nav-item lh-1 me-3">
                  <button type="button" class="btn rounded-pill btn-icon btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEnd" onclick="incomingmessage()" title="Incoming Messages">
                    <span class="tf-icons bx bxl-whatsapp"></span>
                  </button>
                </li>
                <li class="nav-item lh-1 me-3">
                  <button type="button" class="btn rounded-pill btn-icon btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEnd" title="Incoming Messages">
                    <span class="tf-icons bx bx-bell"></span>
                  </button>
                </li>
                <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
                      <img src="img/avatars/8.png" alt class="w-px-40 h-auto rounded-circle" />
                    </div>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <a class="dropdown-item" href="#">
                        <div class="d-flex">
                          <div class="flex-shrink-0 me-3">
                            <div class="avatar avatar-online">
                              <img src="img/avatars/8.png" alt class="w-px-40 h-auto rounded-circle" />
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <span id="profileusername" class="fw-semibold d-block">loading..</span>
                            <small id="profilerole" class="text-muted"></small>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="martechcloudmyprofile.html">
                        <i class="bx bx-user me-2"></i>
                        <span class="align-middle">My Profile</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="martechcloudsettings.html">
                        <i class="bx bx-cog me-2"></i>
                        <span class="align-middle">Settings</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="martechcloudbilling.html">
                        <span class="d-flex align-items-center align-middle">
                          <i class="flex-shrink-0 bx bx-credit-card me-2"></i>
                          <span class="flex-grow-1 align-middle">Billing</span>
                          <span class="flex-shrink-0 badge badge-center rounded-pill bg-danger w-px-20 h-px-20">0</span>
                        </span>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#" onclick="logout()">
                        <i class="bx bx-power-off me-2"></i>
                        <span class="align-middle">Log Out</span>
                      </a>
                    </li>
                  </ul>
                </li>
                <!--/ User -->
              </ul>
            </div>
          </nav>

          <!-- / Navbar -->


          <!-- Content wrapper -->
          <div class="col-lg-3 col-md-6">
            <div class="mt-3">
                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasEnd" aria-labelledby="offcanvasEndLabel">
                    <div class="offcanvas-header">
                        <h5 id="offcanvasEndLabel" class="offcanvas-title">Incoming Messages</h5>
                        <!-- Add refresh icon/button -->
                        <button type="button" class="btn btn-sm btn-primary" id="refreshMessages">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body my-auto mx-0 flex-grow-0" id="messages">
                        <!-- Dynamic cards will be appended here -->
                    </div>
                </div>
            </div>
          </div>
          
          <div
            class="bs-toast toast toast-placement-ex m-2 bg-success bottom-0 end-0"
            role="alert"
            id = "box"
            aria-live="assertive"
            aria-atomic="true"
          >
            <div class="toast-header">
              <i class="bx bx-bell me-2"></i>
              <div class="me-auto fw-semibold">Martech Cloud</div>
              <small>0 mins ago</small>
            </div>
            <div id = "success" class="toast-body">
              New contact has been uploaded in the database sucessfully!
            </div>
          </div>

          <div
            class="bs-toast toast toast-placement-ex m-2 bg-danger bottom-0 end-0"
            role="alert"
            id = "box2"
            aria-live="assertive"
            aria-atomic="true"
          >
            <div class="toast-header">
              <i class="bx bx-bell me-2"></i>
              <div class="me-auto fw-semibold">Martech Cloud</div>
              <small>0 mins ago</small>
            </div>
            <div id = "almessage" class="toast-body">
              Failed!
            </div>
          </div>

          <div id="singleInputForm">
            <div class="content-wrapper">
              <!-- Content -->
              <div class="container-xxl flex-grow-1 container-p-y">
                <!-- Basic Layout -->
                <!-- Basic with Icons -->
                <div class="row pb-3">
                  <div class="card mb-4">
                    <div id="spinner" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; text-align: center;">
                      <div class="spinner-border text-primary" role="status">
                          <span class="sr-only"></span>
                      </div>
                      <p>Loading...</p>
                    </div>
                    &nbsp;
                    <div class="input-group" >
                      <span class="input-group-text"><i class="tf-icons bx bx-search"></i></span>
                      <input
                        type="text"
                        id="search-bar"
                        class="form-control"
                        placeholder="Search for items..."
                        oninput="searchItems()"
                      />
                      <select class="form-select" style="max-width: 180px;" id="exampleFormControlSelect1" aria-label="">
                        <option selected>Select Table</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                        <option value="4">Four</option>
                        <option value="5">Five</option>
                        <option value="6">Six</option> 
                      </select>
                      <button class="btn btn-danger" id="reset-btn">Reset Order</button>
                      <button class="btn btn-secondary" id="draft-btn">Draft Order</button>
                      <button class="btn btn-success" id="next-btn">Complete Order</button>
                    </div>
                    
                    <div class="main-content" style="display: flex; gap: 10px; align-items: center; justify-content: center; ">
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('home')">Home</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('beverages')">Beverages</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('snacks')">Snacks</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('cat1')">Cat 1</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('cat2')">Cat 2</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('home')">Home</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('beverages')">Beverages</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('snacks')">Snacks</button>
                      <button class="btn btn-outline-dark" id="next-btn" onclick="showItems('cat1')">Cat 1</button>
                    </div>
                    
                    <div class="main-content">
                      <div class="menu-items1" id="menu-items"></div>
          
                      <div class="billing" id="billing">
                        <table>
                          <thead>
                            <tr>
                              <th>ITEM NAME</th>
                              <th>QUANTITY</th>
                              <th>PRICE</th>
                              <th>TOTAL</th>
                            </tr>
                          </thead>
                          <tbody>
                            <!-- Dynamic rows will be appended here -->
                          </tbody>
                        </table>
                        <ul id="bill-items">
                        </ul>
                        <div class="total">
                          SUBTOTAL: ₹<span id="subtotal">0.00</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- / Content -->
            </div>
          </div>
          </div></div>


          <script>
            // Global variables
            let items = {};  // Store items dynamically fetched from the API
            let cart = {};   // Store items added to the cart
        
            // Spinner display function
            function showSpinner() {
                document.getElementById('spinner').style.display = 'block';
            }
        
            // Hide spinner
            function hideSpinner() {
                document.getElementById('spinner').style.display = 'none';
            }
        
            // Fetch data from the Apps Script URL only once
            async function fetchData() {
                try {
                    const response = await fetch('https://script.google.com/macros/s/AKfycbzXWL8oN0knVFt2ZV5w6CVSPvZ2iHtToxhQgqova7AobgeP6qEhp50R8lwVNLEndxSp/exec?sheetName=PRODUCT_DATA_TABLE');
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error("Error fetching data: ", error);
                }
            }
        
            // Organize data into categories dynamically (called only once on page load)
            async function organizeItems() {
                const data = await fetchData();
                items = {};  // Reset items
                data.data.slice(1).forEach(row => { // Skip the header row
                    const [productId, productName, productCategory, productPrice] = row;
                    // Check if the category exists, if not create it
                    if (!items[productCategory.toLowerCase()]) {
                        items[productCategory.toLowerCase()] = [];
                    }
                    // Push the item to its respective category
                    items[productCategory.toLowerCase()].push({
                        name: productName.trim(),
                        price: parseFloat(productPrice)
                    });
                });
            }
        
            // Display items dynamically from the loaded data
            async function showItems(category) {
                if (Object.keys(items).length === 0) {
                    await organizeItems(); // Ensure items are loaded before displaying
                }
                
                const menuItemsDiv = document.getElementById('menu-items');
                menuItemsDiv.innerHTML = '';
                
                if (items[category]) {
                    items[category].forEach((item, index) => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'menu-item1';
                        itemDiv.onclick = () => addToCart(category, index);
                        itemDiv.innerHTML = `
                            <img class="card-img-top" src="samplefoodimage.png" alt="Card image cap" />
                            <h5 style="text-align: center; color: #3498db;">${item.name}</h5>
                            <p class="card-text" style="color: #555; font-size: 1rem;">Price: ₹${item.price.toFixed(2)}</p>
                        `;
                        menuItemsDiv.appendChild(itemDiv);
                    });
                } else {
                    menuItemsDiv.innerHTML = `<p>No items available for this category.</p>`;
                }
            }
        
            // Search items based on the user's input
            async function searchItems() {
                const query = document.getElementById('search-bar').value.toLowerCase();
                const menuItemsDiv = document.getElementById('menu-items');
                menuItemsDiv.innerHTML = '';
        
                if (Object.keys(items).length === 0) {
                    await organizeItems(); // Ensure items are loaded before searching
                }
        
                let foundItems = false;
        
                for (const category in items) {
                    items[category].forEach((item, index) => {
                        if (item.name.toLowerCase().includes(query)) {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'menu-item1';
                            itemDiv.onclick = () => addToCart(category, index);
                            itemDiv.innerHTML = `
                                <img class="card-img-top" src="samplefoodimage.png" alt="Card image cap" />
                                <h5 style="text-align: center; color: #3498db;">${item.name}</h5>
                                <p class="card-text">Price: ₹${item.price.toFixed(2)}</p>
                            `;
                            menuItemsDiv.appendChild(itemDiv);
                            foundItems = true;
                        }
                    });
                }
        
                if (!foundItems) {
                    menuItemsDiv.innerHTML = '<p>No items found.</p>';
                }
            }
        
            // Add item to the cart
            function addToCart(category, index) {
                const tableNumber = document.getElementById('exampleFormControlSelect1').value;
                const errorMessage = document.getElementById('box2');
                const alertMessage = document.getElementById('almessage');
                if (tableNumber === "Select Table" || tableNumber === "") {
                  alertMessage.textContent = "Please select a table before proceeding!";
                  errorMessage.style.display = "block"; // Show error message
                  setTimeout(() => {
                    errorMessage.style.display = "none";
                  }, 3000);
                } else {
                  const item = items[category][index];
                  console.log(category)
                  
                  // Check if the item is already in the cart
                  if (!cart[item.name]) {
                      cart[item.name] = { ...item, quantity: 1 }; // Add item with quantity 1
                  } else {
                      cart[item.name].quantity++; // Increase quantity if already in cart
                  }
          
                  updateBilling(); // Call function to update the billing details
              }
            }
                
        
            // Update billing details
            function updateBilling() {
                const billTable = document.querySelector('.billing table tbody');
                const subtotalSpan = document.getElementById('subtotal');
                let subtotal = 0;
        
                // Clear existing table rows
                billTable.innerHTML = '';
        
                // Populate table rows based on cart items
                Object.values(cart).forEach(item => {
                    subtotal += item.price * item.quantity;
        
                    // Create a table row
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>
                            <div class="quantity-control">
                                <button onclick="changeQuantity('${item.name}', -1)">-</button>
                                ${item.quantity}
                                <button onclick="changeQuantity('${item.name}', 1)">+</button>
                            </div>
                        </td>
                        <td>₹${item.price.toFixed(2)}</td>
                        <td>₹${(item.price * item.quantity).toFixed(2)}</td>
                    `;
                    billTable.appendChild(row);
                });
        
                // Handle empty cart
                if (!subtotal) {
                    const emptyRow = document.createElement('tr');
                    emptyRow.innerHTML = `
                        <td colspan="4" style="text-align: center;">No items selected</td>
                    `;
                    billTable.appendChild(emptyRow);
                }
        
                // Update subtotal
                subtotalSpan.textContent = subtotal.toFixed(2);
            }
        
            // Change item quantity in the cart
            function changeQuantity(itemName, delta) {
                if (cart[itemName]) {
                    cart[itemName].quantity += delta;
                    if (cart[itemName].quantity <= 0) {
                        delete cart[itemName];
                    }
                }
                updateBilling();
            }
        
            // Fetch the items on page load to ensure they're available for use in selections
            window.onload = async function() {
                showSpinner(); // Show spinner while data is loading
                await organizeItems(); // Fetch and organize items only once
                showItems('home');
                hideSpinner(); // Hide the spinner once data is loaded
                console.log('Items are now ready for selection.');
            };
        </script>

    <script>
      function incomingmessage() {
        fetchAndDisplayMessages();
      }
    </script>

    <script>
      document.getElementById('refreshMessages').addEventListener('click', function() {
            fetchAndDisplayMessages();
        });
    </script> 

    <script>
      document.getElementById('draft-btn').addEventListener('click', function() {
        // Get the select element
        const selectElement = document.getElementById('exampleFormControlSelect1');
        const errorMessage = document.getElementById('box2');
        const successMessage = document.getElementById('box');
        const alertMessage = document.getElementById('almessage');
        
        
        // Check if the selected value is the default
        if (selectElement.value === "Select Table" || selectElement.value === "") {
          alertMessage.textContent = "Please select a table before proceeding!";
          errorMessage.style.display = "block"; // Show error message
          setTimeout(() => {
            errorMessage.style.display = "none";
          }, 3000);
        } else {
          errorMessage.style.display = "none"; // Hide error message
          // Proceed with your logic
          const tableNumber = document.getElementById('exampleFormControlSelect1').value;
          const selectedOption = document.querySelector(`#exampleFormControlSelect1 option[value="${tableNumber}"]`);
          selectedOption.style.backgroundColor = "green";
          const billTable = document.querySelector('.billing table tbody');
          const subtotalSpan = document.getElementById('subtotal');
          let subtotal = 0;

          // Prepare the data for storage
          const billingData = {
              items: [],
              subtotal: subtotalSpan.textContent
          };

          // Loop through the cart items and gather data
          Object.values(cart).forEach(item => {
              subtotal += item.price * item.quantity;

              // Add each item to the billing data
              billingData.items.push({
                  name: item.name,
                  quantity: item.quantity,
                  price: item.price,
                  total: (item.price * item.quantity).toFixed(2)
              });
          });

          // Store the data in sessionStorage using the table number as the key
          sessionStorage.setItem(tableNumber, JSON.stringify(billingData));
          console.log(sessionStorage.getItem(tableNumber))
          console.log(tableNumber)
          success.textContent = "Order Saved as Draft!";
          successMessage.style.display = "block";
          setTimeout(() => {
            successMessage.style.display = "none";
          }, 3000);
        }
      });
    </script>

    <script>
      function resetBilling() {
          // Get the table body element for billing
          const billTable = document.querySelector('.billing table tbody');
          // Get the subtotal element
          const subtotalSpan = document.getElementById('subtotal');

          // Check if the table body exists and if it has rows
          if (billTable) {
              // Loop through each row and remove its <td> elements
              const rows = billTable.querySelectorAll('tr');
              rows.forEach(row => {
                  const cells = row.querySelectorAll('td');
                  cells.forEach(cell => {
                      row.removeChild(cell); // Remove each <td> element
                  });
              });
          }
          cart = {};

          // Reset the subtotal text to '0.00'
          if (subtotalSpan) {
              subtotalSpan.textContent = '0.00'; // Set the subtotal text to '0.00'
          }
      }
    </script>

    <script>
      // Listen for table selection change
      document.getElementById('exampleFormControlSelect1').addEventListener('change', function() {
          const tableNumber = this.value;

          // Fetch the data from sessionStorage
          const tableData = sessionStorage.getItem(tableNumber);
          console.log(tableData)
          if (tableData) {
              resetBilling();
              showItems('home');
              const billingData = JSON.parse(tableData);

              billingData.items.forEach((item) => {

                  // Search for the item in the #menu-items container
                  const menuItemsContainer = document.getElementById('menu-items');
                  const menuItemsList = Array.from(menuItemsContainer.querySelectorAll('.menu-item1')); // Dynamically created items
                  const itemIndex = menuItemsList.findIndex(menuItem => {
                    // Compare the text inside the <h5> tag to match the item name
                    return menuItem.querySelector('h5').textContent.trim() === item.name;
                  });

                  if (itemIndex !== -1) {
                    // If item is found, run addToCart with 'home' category for the quantity of the item
                    for (let i = 0; i < item.quantity; i++) {
                        addToCart('home', itemIndex); // Add the item to the cart as many times as the quantity
                    }

                  } else {
                      console.warn(`Item "${item.name}" not found in menu-items.`);
                  }
              });

          } else {
            resetBilling();
          }
      });
    </script>

    <script>
      document.getElementById('reset-btn').addEventListener('click', function() {
          resetBilling();
          const tableNumber = document.getElementById('exampleFormControlSelect1').value;
          sessionStorage.removeItem(tableNumber)
          console.log("Session item removed!");
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const menuItems = document.getElementById("menu-items");
        const deviceHeight = window.innerHeight; // Get the device height
        menuItems.style.maxHeight = `${deviceHeight}px`; // Dynamically set the height
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Disable default page scroll
        document.body.style.overflow = "hidden";

        // Dynamically set the max-height of .card.mb-4
        const cards = document.querySelectorAll(".card.mb-4");
        const deviceHeight = window.innerHeight; // Get device viewport height
        const headerHeight = 100; // Adjust based on your header or other elements

        cards.forEach(card => {
          card.style.maxHeight = `${deviceHeight - headerHeight}px`; // Dynamically set max-height
        });
      });
    </script>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="libs/jquery/jquery.js"></script>
    <script src="libs/popper/popper.js"></script>
    <script src="js/bootstrap.js"></script>


    <!--<script src="js/loginauthenticator.js"></script> -->
    <script src="js/logout.js"></script>
    <script src="js/profile.js"></script>

    <script src="libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="js/menu.js"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="libs/apex-charts/apexcharts.js"></script>

    <!-- Main JS -->
    <script src="js/main.js"></script>
    <script src="Martech Cloud/whatsappincomingmessage.js"></script>

    <!-- Page JS -->
    <script src="Martech Cloud/addcontacts.js"></script>
    <script src="Martech Cloud/whatsappincomingmessage.js"></script>
    
    

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>
